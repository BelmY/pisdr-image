---

- name: Install Dependencies
  apt:
    name: "{{ item }}"
  loop:
    - libboost-all-dev
    - swig
    - libzmq3-dev
    - libfftw3-dev
    - libgsl-dev
    - libsdl1.2-dev
    - libusb-1.0-0-dev
    - libasound2-dev
    - portaudio19-dev
    - libportaudio2
    - pulseaudio
    - libjack-dev
    - libgmp-dev
    - libsdl1.2-dev
    - liblog4cpp5-dev
    - libqwt-qt5-dev
    - libqt5opengl5-dev
    - python3-numpy
    - python3-mako
    - python3-sphinx
    - python3-lxml
    - python3-pyqt5
    - python3-yaml
    - python3-click
    - python3-click-plugins
    - python3-zmq
    - python3-scipy
    - python3-pip
    - python3-gi
    - python3-gi-cairo
    - gobject-introspection
    - gir1.2-gtk-3.0

- name: Git checkout
  git:
    repo: "https://github.com/gnuradio/gnuradio.git"
    dest: "{{ install_dir }}/gnuradio"
    version: maint-3.8
    recursive: yes

- name: Build
  shell: |
    set -e
    cd {{ install_dir }}/gnuradio
    mkdir -p build
    cd build
    cmake -GNinja -DCMAKE_TOOLCHAIN_FILE=/etc/pisdr/optimizations.cmake ../
    ninja install
    ldconfig
    echo "$(pwd)" >> {{ config_dir }}/build.dirs